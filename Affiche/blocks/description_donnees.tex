\begin{center}
\begin{tikzpicture}[
      scale=1.5,
      lstm_right/.style={draw, minimum width=1cm, minimum height=.5cm, inner sep=0pt, anchor=north, PaleGreen},
      lstm_left/.style={draw, minimum width=1cm, minimum height=.5cm, inner sep=0pt, PaleBlue},
      every path/.style={line width=\pathwidth},
      every node/.append style={line width=\nodewidth}]
\def\h{2cm}
\def\scalespace{2.2}
\def\w{145mm}
\def\arrowLen{.6}
\def\descSpace{-.2}

% Char embedding

\foreach \word/\color/\w [count=\i] in {Salem/gray/o, Bitar/gray/o, appeared/Purple/w, to/Purple/w, have/Purple/w}{
  \pgfmathsetmacro\pos{\i-1}
  \node[anchor=mid, inner sep=0](\word) at (\scalespace*\pos,0) {\word};
  \node[embed=\color,draw=\color](\word _embed) at (\scalespace*\pos,-\arrowLen){\w};
};

\node[embed=black, minimum width=\w, minimum height=\h, anchor=north](comick) at ([yshift=-\arrowLen cm]appeared_embed.south) {OOV handling net};
% \node[anchor=east, align=left] at ([xshift=\descSpace cm]comick.west) {OOV \\ handling};

\foreach \word/\color/\w [count=\i] in {Salem/predEmbedColor/p, Bitar/predEmbedColor/p, appeared/Purple/w, to/Purple/w, have/Purple/w}{
  \pgfmathsetmacro\pos{\i-1}

  \path (\word _embed) edge[draw, -mytip] (comick.north -| \word _embed.south);
  \draw[-mytip] (comick.south -| \word _embed) -- ++(0,-\arrowLen) node[anchor=north, embed=\color, draw=\color](\word _pred_embed) {\w};

  \node[lstm_left, draw=PaleBlue, anchor=north](\word _lstm_left) at ([yshift=-\arrowLen cm]\word _pred_embed.south) {};
  \node[lstm_right, draw=PaleGreen](\word _lstm_right) at (\word _lstm_left.south) {};
  \draw[-mytip] (\word _pred_embed) -- (\word _lstm_left);

};

% LSTM arrows
\foreach \a/\b in {Salem/Bitar, Bitar/appeared, appeared/to, to/have}{
  \draw[mytip-, PaleBlue] (\a _lstm_left) -- (\b _lstm_left);
  \draw[-mytip, PaleGreen] (\a _lstm_right) -- (\b _lstm_right);
};
% \node[anchor=east, align=left] at ([xshift=\descSpace cm]Salem_lstm_left.south west) {Bi-LSTM \\ task net};


\foreach \word/\tag [count=\i] in {Salem/B-PER, Bitar/I-PER, appeared/O, to/O, have/O}{
  \pgfmathsetmacro\pos{\i-1}

  \draw[-mytip] (\word  _lstm_right.south) -- ++(0,-\arrowLen) node[embed=Orange](\word _softmax) {s};

  \node[anchor=mid, inner sep=0] (\word _tag) at ([yshift=-.5cm]\word _softmax.south) {\tag};
};
% \node[anchor=east, align=right] at ([xshift=\descSpace cm]Salem_tag.west) {Tags};


% Legend
% \begin{scope}[xshift=10.7cm, yshift=-2cm,
\begin{scope}[xshift=-15mm, yshift=-105mm,
        every path/.style={line width=\pathwidth},
        every node/.append style={line width=\nodewidth}]
\def\legspace{-1.3}
\def\colsep{7}
\def\h{1.3cm}
% First col
\node[embed=gray, anchor=center, minimum height=\h, minimum width=.8cm](leg char embed) at (0,0*\legspace) {o};
\node[anchor=west] at (.5,0*\legspace) {OOV word embedding};

\node[embed=Purple, anchor=center, minimum height=\h, minimum width=.8cm](leg word embed) at (0,1*\legspace) {w};
\node[anchor=west] at (.5,1*\legspace) {Word embedding};

\node[embed=predEmbedColor, anchor=center, minimum height=\h, minimum width=.8cm](leg word embed) at (0,2*\legspace) {p};
\node[anchor=west, align=left] at (.5,2*\legspace) {Predicted embedding};


\node[draw, PaleBlue, minimum width=1cm, inner sep=0pt, minimum height=.5cm, anchor=south] (leg lstm left) at (\colsep,0*\legspace) {};
\node[draw, PaleGreen, minimum width=1cm, inner sep=0pt, minimum height=.5cm, anchor=north] (leg lstm right) at (leg lstm left.south) {};
\node[anchor=west] at (\colsep+.5,0*\legspace) {Bidirectional LSTM};

\node[embed=Orange, anchor=center, minimum height=\h, minimum width=.8cm](leg word embed) at (\colsep,1*\legspace) {s};
\node[anchor=west, align=left] at (\colsep+.5,1*\legspace) {Tag prediction\\ with a softmax};

\end{scope}


\end{tikzpicture}
\end{center}
% \vspace{3mm}

Two nets working together: the first predicts OOV embeddings (see OOV handling net section) and the second one predicts tags.

The simple architecture of the labeling net is used to emphasize the usefulness of our module, and to minimize the influence of other factors.

\vspace{-.5mm}